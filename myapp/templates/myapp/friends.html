{% extends 'myapp/base.html' %}
{% load static custom_filter %}

{% block extra_style %}
<link rel="stylesheet" type="text/css" href="{% static 'myapp/css/friends.css' %}" />
{% endblock %}

{% block header-title %}友達{% endblock %}

{% block content %}
<div class="search_box">
    <form action="" method="GET">
        {{ form }}
        <button id=search type="submit" class="btn btn-secondary">検索</button>
    </form>
</div>

<div>自分の名前:{{ request.user.username }}</div>
<div>表示数:{{ user_qs|length }}</div>

{% for user in user_qs %}
<a href="{% url 'talk_room' user.id %}">
  <div class="friend-block">
    <div class="friend-name">{{user.username}}</div>
    <div class="message_content">{{user.latest_msg_content}}</div>
    <div class="message_time">{{user.latest_msg_pub_date|date:"n/j H:i"}}</div>
  </div>
</a>
{% endfor %}
<script>
  const searchBtn = document.getElementById("search");
  const searchInput = document.getElementById("id_find");

  searchBtn.addEventListener("click",function(e){
    e.preventDefault();
    const xhr = new XMLHttpRequest();
    xhr.open("GET","{% url 'search_user' %}?q=" + searchInput.value);
    xhr.send();
    xhr.addEventListener("load",function(){
      console.log(xhr.response)
      const json_data = JSON.parse(xhr.response)
      console.log(typeof json_data)
    })
  })
</script>
{% endblock %}
