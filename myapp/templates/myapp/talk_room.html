{% extends 'myapp/base.html'%}
{% load static %}

{% block extra_style %}
<link rel="stylesheet" type="text/css" href="{% static 'myapp/css/talk_room.css' %}" />
{% endblock %}

{% block header-title %}
<a href="{% url 'friends' %}"><i class="fas fa-angle-left"></i></a>
{{ partner.username }}
{% endblock %}


{% block content %}
<ul class="talk_room__chatboard" id="talk_room__chatboard">
  {% for message in history %}
  {% if message.person_from == user %}
  <li class="talk_room__chatboard-content talk_room__chatboard-content-user">
    <p class="talk_room__chatboard-content-name">＞{{ message.person_from }}</p>
    <p class="talk_room__chatboard-content-text">{{ message.talk }}</p>
    <p class="talk_room__chatboard-content-time">{{ message.time|date:"m/d" }}<br>{{ message.time|date:"H:i" }}</p>
  </li>
  {% else %}
  <li class="talk_room__chatboard-content talk_room__chatboard-content-friend">
    <p class="talk_room__chatboard-content-name">＞{{ message.person_from }}</p>
    <p class="talk_room__chatboard-content-text">{{ message.talk }}</p>
    <p class="talk_room__chatboard-content-time">{{ message.time|date:"m/d" }}<br>{{ message.time|date:"H:i" }}</p>
  </li>
  {% endif %}
  {% endfor %}
</ul>
{% endblock %}

{% block footer %}
<footer class="footer">
  <form class="talk_room__sendbox" id="id_talk" method="POST">
    {% csrf_token %}
    {{ form.talk }}
    <button class="talk_room__sendbox-btn" type="submit">送信</button>
  </form>
</footer>
{% endblock %}

{% block extra_js %}
<!-- 機能を載せるために不可避だったので、ここだけコピペで実装してください -->
<script>
   // 入力予測の表示をさせない（めっちゃ邪魔）
   document.getElementById('id_talk').setAttribute('autocomplete', 'off');
   // トークの表示を新しいものを下にしているため、最下にスクロールさせる
   function scrollToBottom(){
       var height = document.getElementById("talk_room__chatboard");
       window.scroll(0, height.scrollHeight);
   }
       scrollToBottom();
</script>
{% endblock %}