クエリ最適化は自分で考えたので、N+1問題は一応解決できたのですが、あまり最適な方法ではないかもしれません。解答例も見て学習しておきます。